{"ast":null,"code":"import { Component, ElementRef, ViewEncapsulation, HostListener } from '@angular/core';\nimport { isBs3 } from '../utils/ng2-bootstrap-config';\nimport { TypeaheadUtils } from './typeahead-utils';\nexport var TypeaheadContainerComponent = function () {\n  function TypeaheadContainerComponent(element) {\n    this.isFocused = false;\n    this._matches = [];\n    this.element = element;\n  }\n\n  Object.defineProperty(TypeaheadContainerComponent.prototype, \"isBs4\", {\n    get: function () {\n      return !isBs3();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeaheadContainerComponent.prototype, \"active\", {\n    get: function () {\n      return this._active;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeaheadContainerComponent.prototype, \"matches\", {\n    get: function () {\n      return this._matches;\n    },\n    set: function (value) {\n      this._matches = value;\n\n      if (this._matches.length > 0) {\n        this._active = this._matches[0];\n\n        if (this._active.isHeader()) {\n          this.nextActiveMatch();\n        }\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeaheadContainerComponent.prototype, \"optionsListTemplate\", {\n    get: function () {\n      return this.parent ? this.parent.optionsListTemplate : undefined;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TypeaheadContainerComponent.prototype, \"itemTemplate\", {\n    get: function () {\n      return this.parent ? this.parent.typeaheadItemTemplate : undefined;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  TypeaheadContainerComponent.prototype.selectActiveMatch = function () {\n    this.selectMatch(this._active);\n  };\n\n  TypeaheadContainerComponent.prototype.prevActiveMatch = function () {\n    var index = this.matches.indexOf(this._active);\n    this._active = this.matches[index - 1 < 0 ? this.matches.length - 1 : index - 1];\n\n    if (this._active.isHeader()) {\n      this.prevActiveMatch();\n    }\n  };\n\n  TypeaheadContainerComponent.prototype.nextActiveMatch = function () {\n    var index = this.matches.indexOf(this._active);\n    this._active = this.matches[index + 1 > this.matches.length - 1 ? 0 : index + 1];\n\n    if (this._active.isHeader()) {\n      this.nextActiveMatch();\n    }\n  };\n\n  TypeaheadContainerComponent.prototype.selectActive = function (value) {\n    this.isFocused = true;\n    this._active = value;\n  };\n\n  TypeaheadContainerComponent.prototype.hightlight = function (match, query) {\n    var itemStr = match.value;\n    var itemStrHelper = (this.parent && this.parent.typeaheadLatinize ? TypeaheadUtils.latinize(itemStr) : itemStr).toLowerCase();\n    var startIdx;\n    var tokenLen; // Replaces the capture string with the same string inside of a \"strong\" tag\n\n    if (typeof query === 'object') {\n      var queryLen = query.length;\n\n      for (var i = 0; i < queryLen; i += 1) {\n        // query[i] is already latinized and lower case\n        startIdx = itemStrHelper.indexOf(query[i]);\n        tokenLen = query[i].length;\n\n        if (startIdx >= 0 && tokenLen > 0) {\n          itemStr = itemStr.substring(0, startIdx) + '<strong>' + itemStr.substring(startIdx, startIdx + tokenLen) + '</strong>' + itemStr.substring(startIdx + tokenLen);\n          itemStrHelper = itemStrHelper.substring(0, startIdx) + '        ' + ' '.repeat(tokenLen) + '         ' + itemStrHelper.substring(startIdx + tokenLen);\n        }\n      }\n    } else if (query) {\n      // query is already latinized and lower case\n      startIdx = itemStrHelper.indexOf(query);\n      tokenLen = query.length;\n\n      if (startIdx >= 0 && tokenLen > 0) {\n        itemStr = itemStr.substring(0, startIdx) + '<strong>' + itemStr.substring(startIdx, startIdx + tokenLen) + '</strong>' + itemStr.substring(startIdx + tokenLen);\n      }\n    }\n\n    return itemStr;\n  };\n\n  TypeaheadContainerComponent.prototype.focusLost = function () {\n    this.isFocused = false;\n  };\n\n  TypeaheadContainerComponent.prototype.isActive = function (value) {\n    return this._active === value;\n  };\n\n  TypeaheadContainerComponent.prototype.selectMatch = function (value, e) {\n    var _this = this;\n\n    if (e === void 0) {\n      e = void 0;\n    }\n\n    if (e) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    this.parent.changeModel(value);\n    setTimeout(function () {\n      return _this.parent.typeaheadOnSelect.emit(value);\n    }, 0);\n    return false;\n  };\n\n  TypeaheadContainerComponent.decorators = [{\n    type: Component,\n    args: [{\n      selector: 'typeahead-container',\n      // tslint:disable-next-line\n      template: \"\\n<!-- inject options list template -->\\n<template [ngTemplateOutlet]=\\\"optionsListTemplate || (isBs4 ? bs4Template : bs3Template)\\\"\\n  [ngOutletContext]=\\\"{matches:matches, itemTemplate:itemTemplate, query:query}\\\"></template>\\n\\n<!-- default options item template -->\\n<template #bsItemTemplate let-match=\\\"match\\\" let-query=\\\"query\\\"><span [innerHtml]=\\\"hightlight(match, query)\\\"></span></template>\\n\\n<!-- Bootstrap 3 options list template -->\\n<template #bs3Template>\\n<ul class=\\\"dropdown-menu\\\">\\n  <template ngFor let-match let-i=\\\"index\\\" [ngForOf]=\\\"matches\\\">\\n    <li *ngIf=\\\"match.isHeader()\\\" class=\\\"dropdown-header\\\">{{match}}</li>\\n    <li *ngIf=\\\"!match.isHeader()\\\" [class.active]=\\\"isActive(match)\\\" (mouseenter)=\\\"selectActive(match)\\\">\\n      <a href=\\\"#\\\" (click)=\\\"selectMatch(match, $event)\\\" tabindex=\\\"-1\\\">\\n        <template [ngTemplateOutlet]=\\\"itemTemplate || bsItemTemplate\\\" \\n          [ngOutletContext]=\\\"{item:match.item, index:i, match:match, query:query}\\\"></template>\\n      </a>\\n    </li>\\n  </template>\\n</ul>\\n</template>\\n\\n<!-- Bootstrap 4 options list template -->\\n<template #bs4Template >\\n<template ngFor let-match let-i=\\\"index\\\" [ngForOf]=\\\"matches\\\">\\n   <h6 *ngIf=\\\"match.isHeader()\\\" class=\\\"dropdown-header\\\">{{match}}</h6>\\n   <template [ngIf]=\\\"!match.isHeader()\\\">\\n      <button\\n        class=\\\"dropdown-item\\\"\\n        (click)=\\\"selectMatch(match, $event)\\\"\\n        (mouseenter)=\\\"selectActive(match)\\\"\\n        [class.active]=\\\"isActive(match)\\\">\\n          <template [ngTemplateOutlet]=\\\"itemTemplate || bsItemTemplate\\\" \\n            [ngOutletContext]=\\\"{item:match.item, index:i, match:match, query:query}\\\"></template>\\n      </button>\\n  </template>\\n</template>\\n</template>\\n\",\n      // tslint:disable\n      host: {\n        'class': 'dropdown open',\n        '[class.dropdown-menu]': 'isBs4',\n        style: 'position: absolute;display: block;'\n      },\n      // tslint: enable\n      encapsulation: ViewEncapsulation.None\n    }]\n  }];\n  /** @nocollapse */\n\n  TypeaheadContainerComponent.ctorParameters = function () {\n    return [{\n      type: ElementRef\n    }];\n  };\n\n  TypeaheadContainerComponent.propDecorators = {\n    'focusLost': [{\n      type: HostListener,\n      args: ['mouseleave']\n    }, {\n      type: HostListener,\n      args: ['blur']\n    }]\n  };\n  return TypeaheadContainerComponent;\n}(); //# sourceMappingURL=typeahead-container.component.js.map","map":null,"metadata":{},"sourceType":"module"}